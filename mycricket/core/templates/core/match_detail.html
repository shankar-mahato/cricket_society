{% extends 'core/base.html' %}

{% block title %}{{ match }} - Match Details{% endblock %}

{% block content %}
<!-- Back Button -->
<div style="margin-bottom: 16px;">
    <button onclick="window.history.back();" class="back-button" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #f7fafc; border: 1px solid #e2e8f0; border-radius: 8px; color: #4a5568; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.2s;">
        <span>‚Üê</span>
        <span>Back</span>
    </button>
</div>

<div class="match-detail-header">
    <div class="match-detail-card match-{{ match.status }}">
        <!-- Teams Section -->
        <div class="match-teams-section-detail">
            <!-- Team A -->
            <div class="team-section-detail team-a">
                {% if match.team_a.logo %}
                    <img src="{{ match.team_a.logo.url }}" alt="{{ match.team_a.name }}" class="team-logo-detail">
                {% elif match.team_a.logo_url %}
                    <img src="{{ match.team_a.logo_url }}" alt="{{ match.team_a.name }}" class="team-logo-detail">
                {% else %}
                    <div class="team-logo-placeholder-detail team-a-placeholder">
                        {{ match.team_a.name|first|upper }}
                    </div>
                {% endif %}
                <div class="team-name-detail">{{ match.team_a.name }}</div>
            </div>
            
            <!-- VS Divider -->
            <div class="vs-divider-detail">
                <span>VS</span>
            </div>
            
            <!-- Team B -->
            <div class="team-section-detail team-b">
                {% if match.team_b.logo %}
                    <img src="{{ match.team_b.logo.url }}" alt="{{ match.team_b.name }}" class="team-logo-detail">
                {% elif match.team_b.logo_url %}
                    <img src="{{ match.team_b.logo_url }}" alt="{{ match.team_b.name }}" class="team-logo-detail">
                {% else %}
                    <div class="team-logo-placeholder-detail team-b-placeholder">
                        {{ match.team_b.name|first|upper }}
                    </div>
                {% endif %}
                <div class="team-name-detail">{{ match.team_b.name }}</div>
            </div>
        </div>
        
        <!-- Match Title -->
        <div class="match-title-section">
            <p class="match-title-text">{{ match.match_title }}</p>
        </div>
        
        <!-- Info Section -->
        <div class="match-info-section-detail">
            <div class="info-item">
                <span class="info-icon">üìç</span>
                <span class="info-label">Venue:</span>
                <span class="info-value">{{ match.venue }}</span>
            </div>
            <div class="info-item">
                <span class="info-icon">üìÖ</span>
                <span class="info-label">Date:</span>
                <span class="info-value">{{ match.match_date|date:"M d, Y H:i" }}</span>
            </div>
            <div class="info-item">
                <span class="info-icon">‚ö°</span>
                <span class="info-label">Status:</span>
                <span class="status-badge-detail {% if match.status == 'live' %}status-live{% elif match.status == 'completed' %}status-completed{% else %}status-upcoming{% endif %}">
                    {{ match.get_status_display }}
                </span>
            </div>
        </div>
    </div>
</div>

{% if existing_session %}
    <div class="card" style="background: #fffaf0; border-color: #ed8936;">
        <h3 style="margin: 0 0 12px 0;">Active Session</h3>
        <p style="margin: 0 0 16px 0; color: #7c2d12;">You have an active session for this match.</p>
        <a href="{% url 'core:session_detail' existing_session.id %}" class="btn">Go to Session</a>
    </div>
{% else %}
    <!-- Betting Options Accordions -->
    <div class="betting-accordions-container">
        <!-- Bet on Match Accordion (First - Expanded by default) -->
        <div class="betting-accordion-item">
            <div class="betting-accordion-header active" onclick="toggleBettingAccordion('bet-on-match')">
                <span class="betting-accordion-title">Bet on Match</span>
                <span class="betting-accordion-arrow" id="arrow-bet-on-match">‚ñº</span>
            </div>
            <div id="bet-on-match" class="betting-accordion-content show">
            {% if match.status == 'upcoming' %}
            <!-- Message for upcoming matches -->
            <div class="match-not-started-message">
                <div class="message-icon">‚è≥</div>
                <div class="message-title">Match Not Yet Started</div>
                <div class="message-text">Betting options will be available once the match begins. Please check back later.</div>
            </div>
            {% else %}
            <!-- Runner Section -->
            <div class="betting-market">
                <div class="market-title">Runner</div>
                <div class="runner-row header-row">
                    <div>TEAM</div>
                    <div style="text-align: center;">BACK</div>
                    <div style="text-align: center;">LAY</div>
                </div>
                {% for odds in match_odds %}
                <div class="runner-row" data-runner="{{ odds.runner }}" data-back-odds="{{ odds.back_odds }}" data-lay-odds="{{ odds.lay_odds }}">
                    <div class="runner-name">
                        {{ odds.runner }}
                        {% for key, balance in user_balances.items %}
                            {% if key == odds.runner %}
                            <div class="balance-display {% if balance >= 0 %}balance-positive{% else %}balance-negative{% endif %}" id="balance-{{ odds.runner|slugify }}">
                                {% if balance >= 0 %}+{% endif %}{{ balance|floatformat:0 }}
                            </div>
                            {% endif %}
                        {% empty %}
                        <div class="balance-display hidden" id="balance-{{ odds.runner|slugify }}"></div>
                        {% endfor %}
                        {% if odds.runner not in user_balances %}
                        <div class="balance-display hidden" id="balance-{{ odds.runner|slugify }}"></div>
                        {% endif %}
                        <span class="stake-info hidden" id="stake-{{ forloop.counter0 }}"></span>
                    </div>
                    <div class="odds-cell-wrapper">
                        <div class="odds-cell" style="text-align: center; cursor: pointer;" 
                             data-selection="{{ odds.runner|escapejs }}" 
                             data-type="back" 
                             data-odds="{{ odds.back_odds }}"
                             onclick="event.stopPropagation(); toggleBetDropdown(this);">
                            <span class="odds-back">{{ odds.back_odds }}</span>
                        </div>
                        <div class="bet-dropdown" id="dropdown-{{ forloop.counter0 }}-back"
                             data-selection="{{ odds.runner|escapejs }}" data-type="back" data-odds="{{ odds.back_odds }}">
                            <div class="bet-dropdown-header back-header">
                                <span>BACK - {{ odds.runner }}</span>
                                <button class="close-dropdown" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">√ó</button>
                            </div>
                            <div class="bet-dropdown-body">
                                <div class="bet-input-row">
                                    <div class="bet-input-label back-label">Odds</div>
                                    <div class="odds-control">
                                        <button class="odds-btn back-btn minus" onclick="adjustOddsDropdown(this, -0.01)">-</button>
                                        <input type="number" class="odds-input-dropdown" step="0.01" min="1.01" value="{{ odds.back_odds }}" readonly>
                                        <button class="odds-btn back-btn plus" onclick="adjustOddsDropdown(this, 0.01)">+</button>
                                    </div>
                                </div>
                                <div class="bet-input-row">
                                    <div class="bet-input-label back-label">Stake</div>
                                    <div class="stake-control">
                                        <input type="number" class="stake-input-dropdown" min="100" step="100" placeholder="0">
                                        <span class="stake-display-dropdown">0</span>
                                    </div>
                                </div>
                                <div class="quick-stake-buttons">
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 1000)">+1000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 5000)">+5000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 10000)">+10000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 25000)">+25000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 50000)">+50000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 100000)">+100000</button>
                                </div>
                                <div class="bet-dropdown-actions">
                                    <button class="bet-cancel-btn" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">CANCEL</button>
                                    <button class="bet-submit-btn" onclick="event.stopPropagation(); event.preventDefault(); submitBetDropdown(this);" type="button">PLACE BET</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="odds-cell-wrapper">
                        <div class="odds-cell" style="text-align: center; cursor: pointer;" 
                             data-selection="{{ odds.runner|escapejs }}" 
                             data-type="lay" 
                             data-odds="{{ odds.lay_odds }}"
                             onclick="event.stopPropagation(); toggleBetDropdown(this);">
                            <span class="odds-lay">{{ odds.lay_odds }}</span>
                        </div>
                        <div class="bet-dropdown" id="dropdown-{{ forloop.counter0 }}-lay"
                             data-selection="{{ odds.runner|escapejs }}" data-type="lay" data-odds="{{ odds.lay_odds }}">
                            <div class="bet-dropdown-header lay-header">
                                <span>LAY - {{ odds.runner }}</span>
                                <button class="close-dropdown" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">√ó</button>
                            </div>
                            <div class="bet-dropdown-body">
                                <div class="bet-input-row">
                                    <div class="bet-input-label lay-label">Odds</div>
                                    <div class="odds-control">
                                        <button class="odds-btn lay-btn minus" onclick="adjustOddsDropdown(this, -0.01)">-</button>
                                        <input type="number" class="odds-input-dropdown" step="0.01" min="1.01" value="{{ odds.lay_odds }}" readonly>
                                        <button class="odds-btn lay-btn plus" onclick="adjustOddsDropdown(this, 0.01)">+</button>
                                    </div>
                                </div>
                                <div class="bet-input-row">
                                    <div class="bet-input-label lay-label">Stake</div>
                                    <div class="stake-control">
                                        <input type="number" class="stake-input-dropdown" min="100" step="100" placeholder="0">
                                        <span class="stake-display-dropdown">0</span>
                                    </div>
                                </div>
                                <div class="quick-stake-buttons">
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 1000)">+1000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 5000)">+5000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 10000)">+10000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 25000)">+25000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 50000)">+50000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 100000)">+100000</button>
                                </div>
                                <div class="bet-dropdown-actions">
                                    <button class="bet-cancel-btn" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">CANCEL</button>
                                    <button class="bet-submit-btn" onclick="event.stopPropagation(); event.preventDefault(); submitBetDropdown(this);" type="button">PLACE BET</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Session Details Section -->
            <div class="session-details">
                <div class="market-title">Session Details</div>
                <div class="session-detail-row header-row">
                    <div>SESSION</div>
                    <div style="text-align: center;">BACK</div>
                    <div style="text-align: center;">LAY</div>
                </div>
                {% for detail in session_details %}
                <div class="session-detail-row">
                    <div class="session-detail-label">{{ detail.label }}</div>
                    <div class="odds-cell-wrapper">
                        <div class="odds-cell" style="text-align: center; cursor: pointer;" 
                             data-selection="{{ detail.label|escapejs }}" 
                             data-type="not" 
                             data-odds="{{ detail.not }}"
                             onclick="event.stopPropagation(); toggleBetDropdown(this);">
                            <span class="odds-back">{{ detail.not }}</span>
                        </div>
                        <div class="bet-dropdown" id="dropdown-session-{{ forloop.counter0 }}-not"
                             data-selection="{{ detail.label|escapejs }}" data-type="not" data-odds="{{ detail.not }}">
                            <div class="bet-dropdown-header back-header">
                                <span>NOT - {{ detail.label }}</span>
                                <button class="close-dropdown" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">√ó</button>
                            </div>
                            <div class="bet-dropdown-body">
                                <div class="bet-input-row">
                                    <div class="bet-input-label back-label">Odds</div>
                                    <div class="odds-control">
                                        <button class="odds-btn back-btn minus" onclick="adjustOddsDropdown(this, -0.01)">-</button>
                                        <input type="number" class="odds-input-dropdown" step="0.01" min="1.01" value="{{ detail.not }}" readonly>
                                        <button class="odds-btn back-btn plus" onclick="adjustOddsDropdown(this, 0.01)">+</button>
                                    </div>
                                </div>
                                <div class="bet-input-row">
                                    <div class="bet-input-label back-label">Stake</div>
                                    <div class="stake-control">
                                        <input type="number" class="stake-input-dropdown" min="100" step="100" placeholder="0">
                                        <span class="stake-display-dropdown">0</span>
                                    </div>
                                </div>
                                <div class="quick-stake-buttons">
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 1000)">+1000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 5000)">+5000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 10000)">+10000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 25000)">+25000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 50000)">+50000</button>
                                    <button class="quick-stake-btn back-stake" onclick="addStakeDropdown(this, 100000)">+100000</button>
                                </div>
                                <div class="bet-dropdown-actions">
                                    <button class="bet-cancel-btn" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">CANCEL</button>
                                    <button class="bet-submit-btn" onclick="event.stopPropagation(); event.preventDefault(); submitBetDropdown(this);" type="button">PLACE BET</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="odds-cell-wrapper">
                        <div class="odds-cell" style="text-align: center; cursor: pointer;" 
                             data-selection="{{ detail.label|escapejs }}" 
                             data-type="yes" 
                             data-odds="{{ detail.yes }}"
                             onclick="event.stopPropagation(); toggleBetDropdown(this);">
                            <span class="odds-lay">{{ detail.yes }}</span>
                        </div>
                        <div class="bet-dropdown" id="dropdown-session-{{ forloop.counter0 }}-yes"
                             data-selection="{{ detail.label|escapejs }}" data-type="yes" data-odds="{{ detail.yes }}">
                            <div class="bet-dropdown-header lay-header">
                                <span>YES - {{ detail.label }}</span>
                                <button class="close-dropdown" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">√ó</button>
                            </div>
                            <div class="bet-dropdown-body">
                                <div class="bet-input-row">
                                    <div class="bet-input-label lay-label">Odds</div>
                                    <div class="odds-control">
                                        <button class="odds-btn lay-btn minus" onclick="adjustOddsDropdown(this, -0.01)">-</button>
                                        <input type="number" class="odds-input-dropdown" step="0.01" min="1.01" value="{{ detail.yes }}" readonly>
                                        <button class="odds-btn lay-btn plus" onclick="adjustOddsDropdown(this, 0.01)">+</button>
                                    </div>
                                </div>
                                <div class="bet-input-row">
                                    <div class="bet-input-label lay-label">Stake</div>
                                    <div class="stake-control">
                                        <input type="number" class="stake-input-dropdown" min="100" step="100" placeholder="0">
                                        <span class="stake-display-dropdown">0</span>
                                    </div>
                                </div>
                                <div class="quick-stake-buttons">
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 1000)">+1000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 5000)">+5000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 10000)">+10000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 25000)">+25000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 50000)">+50000</button>
                                    <button class="quick-stake-btn lay-stake" onclick="addStakeDropdown(this, 100000)">+100000</button>
                                </div>
                                <div class="bet-dropdown-actions">
                                    <button class="bet-cancel-btn" onclick="event.stopPropagation(); event.preventDefault(); closeBetDropdown(this.closest('.bet-dropdown'));" type="button">CANCEL</button>
                                    <button class="bet-submit-btn" onclick="event.stopPropagation(); event.preventDefault(); submitBetDropdown(this);" type="button">PLACE BET</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            </div>
        </div>

        <!-- Choose Virtual Batsmen Accordion (Second - Collapsed by default) -->
        <div class="betting-accordion-item">
            <div class="betting-accordion-header" onclick="toggleBettingAccordion('choose-virtual')">
                <span class="betting-accordion-title">Choose Virtual Batsmen</span>
                <span class="betting-accordion-arrow" id="arrow-choose-virtual">‚ñ∂</span>
            </div>
            <div id="choose-virtual" class="betting-accordion-content">
                <div class="virtual-batsmen-content">
            <div class="card-header" style="margin-bottom: 20px;">
                <h3 style="margin: 0;">Create New Betting Session</h3>
            </div>
            <p style="margin: 0 0 20px 0; color: #4a5568;">Create a betting session and invite a friend to play. You'll pick players and bet on how many runs they'll score.</p>
            <form method="post" action="{% url 'core:create_betting_session' match.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <label class="form-label" for="players_per_side">Number of players per side</label>
                    <input type="number" id="players_per_side" name="players_per_side" value="5" min="1" max="11" required class="form-control">
                    <p style="margin: 8px 0 0 0; color: #718096; font-size: 13px;">You'll pick this many players from each team ({{ match.team_a.name }} and {{ match.team_b.name }})</p>
                </div>
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label" for="fixed_bet_amount">Fixed Bet Amount (‚Çπ)</label>
                    <input type="number" id="fixed_bet_amount" name="fixed_bet_amount" value="100" min="0.01" step="0.01" required class="form-control">
                    <p style="margin: 8px 0 0 0; color: #718096; font-size: 13px;">Fixed bet amount for the entire session. Winner gets both bet amounts (‚Çπ<span id="total_pot">200</span>).</p>
                </div>
                <button type="submit" class="btn">Create Session</button>
            </form>
            <script>
                document.getElementById('fixed_bet_amount').addEventListener('input', function() {
                    const amount = parseFloat(this.value) || 0;
                    document.getElementById('total_pot').textContent = (amount * 2).toFixed(2);
                });
            </script>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% if available_sessions %}
    <div class="card">
        <div class="card-header">
            <h3>Available Sessions to Join</h3>
        </div>
        <p style="margin: 0 0 16px 0; color: #4a5568;">Other players are waiting for opponents. Join one of these sessions:</p>
        <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Created By</th>
                    <th>Players Per Side</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for session in available_sessions %}
                    <tr>
                        <td><strong>{{ session.better_a.username }}</strong></td>
                        <td>{{ session.players_per_side }} players each</td>
                        <td>
                            <form method="post" action="{% url 'core:join_betting_session' session.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success">Join</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
{% endif %}

<!-- Players Section - Show when virtual batsmen option is selected or session exists -->
<div id="players-section" {% if existing_session %}style="display: block;"{% else %}style="display: none;"{% endif %}>
    {% if team_a_players or team_b_players %}
        <div class="card">
            <div class="card-header">
                <h3>{{ match.team_a.name }} Players</h3>
            </div>
            <div class="player-list">
                {% for player in team_a_players %}
                    <div class="player-card">
                        {% if player.picture %}
                            <img src="{{ player.picture.url }}" alt="{{ player.name }}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-bottom: 8px;">
                        {% else %}
                            <div style="width: 60px; height: 60px; border-radius: 50%; background: #e2e8f0; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; color: #4a5568; font-size: 24px;">
                                üë§
                            </div>
                        {% endif %}
                        <strong style="display: block; margin-bottom: 4px;">{{ player.name }}</strong>
                        {% if player.role %}<small style="color: #718096;">{{ player.role }}</small>{% endif %}
                    </div>
                {% empty %}
                    <p style="text-align: center; color: #718096; padding: 20px; grid-column: 1 / -1;">No players available</p>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>{{ match.team_b.name }} Players</h3>
            </div>
            <div class="player-list">
                {% for player in team_b_players %}
                    <div class="player-card">
                        {% if player.picture %}
                            <img src="{{ player.picture.url }}" alt="{{ player.name }}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-bottom: 8px;">
                        {% else %}
                            <div style="width: 60px; height: 60px; border-radius: 50%; background: #e2e8f0; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; color: #4a5568; font-size: 24px;">
                                üë§
                            </div>
                        {% endif %}
                        <strong style="display: block; margin-bottom: 4px;">{{ player.name }}</strong>
                        {% if player.role %}<small style="color: #718096;">{{ player.role }}</small>{% endif %}
                    </div>
                {% empty %}
                    <p style="text-align: center; color: #718096; padding: 20px; grid-column: 1 / -1;">No players available</p>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="card" style="background: #ebf8ff; border-color: #4299e1;">
            <p style="margin: 0; color: #2c5282;">
                <strong>Note:</strong> Player lists will be available after you create or join a betting session.
            </p>
        </div>
    {% endif %}
</div>

<script>
function toggleBettingAccordion(accordionId) {
    const accordionContent = document.getElementById(accordionId);
    const accordionHeader = accordionContent.previousElementSibling;
    const accordionArrow = document.getElementById('arrow-' + accordionId);
    
    if (accordionContent.classList.contains('show')) {
        // Close accordion
        accordionContent.classList.remove('show');
        if (accordionHeader) accordionHeader.classList.remove('active');
        if (accordionArrow) {
            accordionArrow.style.transform = 'rotate(0deg)';
            accordionArrow.textContent = '‚ñ∂';
        }
        // Hide players section if closing virtual batsmen
        if (accordionId === 'choose-virtual') {
            const playersSection = document.getElementById('players-section');
            if (playersSection) playersSection.style.display = 'none';
        }
    } else {
        // Open accordion
        accordionContent.classList.add('show');
        if (accordionHeader) accordionHeader.classList.add('active');
        if (accordionArrow) {
            accordionArrow.style.transform = 'rotate(90deg)';
            accordionArrow.textContent = '‚ñº';
        }
        // Show players section if opening virtual batsmen
        if (accordionId === 'choose-virtual') {
            const playersSection = document.getElementById('players-section');
            if (playersSection) playersSection.style.display = 'block';
        } else {
            // Hide players section for bet on match
            const playersSection = document.getElementById('players-section');
            if (playersSection) playersSection.style.display = 'none';
        }
    }
}

let openDropdown = null;

function toggleBetDropdown(element) {
    const selection = element.getAttribute('data-selection');
    const type = element.getAttribute('data-type');
    const odds = element.getAttribute('data-odds');
    
    if (!selection || !type || !odds) {
        console.error('Missing data attributes on odds cell');
        return;
    }
    
    const dropdown = element.nextElementSibling;
    
    if (!dropdown || !dropdown.classList.contains('bet-dropdown')) {
        return;
    }
    
    if (openDropdown && openDropdown !== dropdown) {
        closeBetDropdown(openDropdown);
    }
    
    if (dropdown.classList.contains('show')) {
        closeBetDropdown(dropdown);
    } else {
        document.querySelectorAll('.bet-dropdown.show').forEach(d => {
            if (d !== dropdown) {
                closeBetDropdown(d);
            }
        });
        
        dropdown.setAttribute('data-selection', selection);
        dropdown.setAttribute('data-type', type);
        dropdown.setAttribute('data-odds', odds);
        
        dropdown.classList.add('show');
        dropdown.style.display = 'flex';
        dropdown.style.visibility = 'visible';
        dropdown.style.opacity = '1';
        openDropdown = dropdown;
        
        if (window.innerWidth <= 768) {
            const scrollY = window.scrollY || window.pageYOffset || document.documentElement.scrollTop;
            dropdown.dataset.scrollY = scrollY;
            
            // Prevent body scroll but keep smooth scrolling behavior
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
            document.body.style.top = `-${scrollY}px`;
            document.body.style.left = '0';
            document.body.style.right = '0';
            
            // Prevent scrolling on html element too
            document.documentElement.style.overflow = 'hidden';
            document.documentElement.style.position = 'fixed';
            document.documentElement.style.width = '100%';
            document.documentElement.style.top = `-${scrollY}px`;
            
            const dropdownBody = dropdown.querySelector('.bet-dropdown-body');
            if (dropdownBody) {
                dropdownBody.style.overflowY = 'auto';
                dropdownBody.style.webkitOverflowScrolling = 'touch';
                dropdownBody.style.touchAction = 'pan-y';
                dropdownBody.style.overscrollBehavior = 'contain';
                dropdownBody.style.scrollBehavior = 'smooth';
            }
        }
        
        const oddsInput = dropdown.querySelector('.odds-input-dropdown');
        const stakeInput = dropdown.querySelector('.stake-input-dropdown');
        const stakeDisplay = dropdown.querySelector('.stake-display-dropdown');
        
        if (oddsInput) oddsInput.value = odds;
        if (stakeInput) {
            stakeInput.value = '';
            const newStakeInput = stakeInput.cloneNode(true);
            stakeInput.parentNode.replaceChild(newStakeInput, stakeInput);
            newStakeInput.addEventListener('input', function() {
                updateStakeDisplayDropdown(this, dropdown.querySelector('.stake-display-dropdown'));
            });
        }
        if (stakeDisplay) stakeDisplay.textContent = '0';
        
        setTimeout(() => {
            const focusInput = dropdown.querySelector('.stake-input-dropdown');
            if (focusInput) focusInput.focus();
        }, 100);
    }
}

function closeBetDropdown(dropdownElement) {
    let dropdown = null;
    
    if (typeof dropdownElement === 'object' && dropdownElement.closest) {
        dropdown = dropdownElement.closest('.bet-dropdown');
    } else if (dropdownElement && dropdownElement.classList) {
        dropdown = dropdownElement;
    }
    
    if (dropdown) {
        dropdown.classList.remove('show');
        dropdown.style.display = 'none';
        dropdown.style.visibility = 'hidden';
        dropdown.style.opacity = '0';
        
        if (openDropdown === dropdown) {
            openDropdown = null;
        }
        
        if (window.innerWidth <= 768) {
            // Restore body scroll position
            const scrollY = dropdown.dataset.scrollY || 0;
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            document.body.style.top = '';
            document.body.style.left = '';
            document.body.style.right = '';
            
            // Restore html element scrolling
            document.documentElement.style.overflow = '';
            document.documentElement.style.position = '';
            document.documentElement.style.width = '';
            document.documentElement.style.top = '';
            
            // Restore scroll position smoothly
            requestAnimationFrame(() => {
                window.scrollTo({
                    top: parseInt(scrollY) || 0,
                    behavior: 'auto'
                });
            });
        } else {
            document.body.style.overflow = 'auto';
            document.documentElement.style.overflow = 'auto';
        }
    }
}

function adjustOddsDropdown(button, change) {
    const dropdown = button.closest('.bet-dropdown');
    if (!dropdown) return;
    
    const oddsInput = dropdown.querySelector('.odds-input-dropdown');
    if (!oddsInput) return;
    
    let currentOdds = parseFloat(oddsInput.value) || 1.01;
    let newOdds = currentOdds + change;
    
    if (newOdds < 1.01) {
        newOdds = 1.01;
    }
    
    newOdds = Math.round(newOdds * 100) / 100;
    oddsInput.value = newOdds.toFixed(2);
    
    const stakeInput = dropdown.querySelector('.stake-input-dropdown');
    const stakeAmount = parseFloat(stakeInput ? stakeInput.value : 0) || 0;
    if (stakeAmount > 0) {
        updateStakeDisplayDropdown(stakeInput, dropdown.querySelector('.stake-display-dropdown'));
    }
}

function addStakeDropdown(button, amount) {
    const dropdown = button.closest('.bet-dropdown');
    if (!dropdown) return;
    
    const stakeInput = dropdown.querySelector('.stake-input-dropdown');
    if (!stakeInput) return;
    
    const currentStake = parseFloat(stakeInput.value) || 0;
    const newStake = currentStake + amount;
    stakeInput.value = newStake;
    updateStakeDisplayDropdown(stakeInput, dropdown.querySelector('.stake-display-dropdown'));
}

function updateStakeDisplayDropdown(stakeInput, stakeDisplay) {
    if (!stakeInput || !stakeDisplay) return;
    
    const amount = parseFloat(stakeInput.value) || 0;
    stakeDisplay.textContent = amount.toLocaleString('en-IN');
}

function submitBetDropdown(button) {
    const dropdown = button.closest('.bet-dropdown');
    if (!dropdown) return;
    
    const selection = dropdown.getAttribute('data-selection');
    const type = dropdown.getAttribute('data-type');
    
    if (!selection || !type) {
        console.error('Missing data attributes on dropdown');
        return;
    }
    
    const stakeInput = dropdown.querySelector('.stake-input-dropdown');
    const oddsInput = dropdown.querySelector('.odds-input-dropdown');
    
    if (!stakeInput || !oddsInput) return;
    
    const amount = parseFloat(stakeInput.value);
    const odds = parseFloat(oddsInput.value);
    
    // Validate minimum stake
    if (!amount || amount < 100) {
        alert(`Minimum stake amount is ‚Çπ100. You entered ‚Çπ${amount || 0}.`);
        return;
    }
    
    const matchId = {{ match.id }};
    
    fetch(`/dl/match/${matchId}/place-bet/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            selection: selection,
            bet_type: type,
            odds: odds,
            stake: amount
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update balances if provided
            if (data.balances) {
                updateBalances(data.balances);
            }
            
            closeBetDropdown(dropdown);
            stakeInput.value = '';
            const stakeDisplay = dropdown.querySelector('.stake-display-dropdown');
            if (stakeDisplay) stakeDisplay.textContent = '0';
            
            // Reload page to show updated bets
            window.location.reload();
        } else {
            // Show error message to user
            const errorMsg = data.error || 'Failed to place bet. Please try again.';
            alert(errorMsg);
            console.error('Error placing bet:', errorMsg);
        }
    })
    .catch(error => {
        console.error('Error placing bet:', error);
    });
}

function updateBalances(balances) {
    // Update balances for each selection
    Object.keys(balances).forEach(selection => {
        const balance = balances[selection];
        updateBalanceDisplay(selection, balance);
    });
}

function updateBalanceDisplay(selection, balance) {
    // Find the runner row that matches the selection
    const runnerRows = document.querySelectorAll('.runner-row[data-runner]');
    let targetRow = null;
    
    runnerRows.forEach((row) => {
        if (row.getAttribute('data-runner') === selection) {
            targetRow = row;
        }
    });
    
    if (!targetRow) return;
    
    // Find or create balance display element
    let balanceDisplay = targetRow.querySelector('.balance-display');
    
    if (!balanceDisplay) {
        const runnerName = targetRow.querySelector('.runner-name');
        if (runnerName) {
            balanceDisplay = document.createElement('div');
            balanceDisplay.className = 'balance-display';
            balanceDisplay.id = 'balance-' + selection.toLowerCase().replace(/\s+/g, '-');
            runnerName.appendChild(balanceDisplay);
        }
    }
    
    if (balanceDisplay) {
        const formattedBalance = balance >= 0 ? `+${Math.round(balance)}` : `${Math.round(balance)}`;
        balanceDisplay.textContent = formattedBalance;
        balanceDisplay.className = 'balance-display ' + (balance >= 0 ? 'balance-positive' : 'balance-negative');
        balanceDisplay.classList.remove('hidden');
    }
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

document.addEventListener('click', function(e) {
    if (openDropdown && window.innerWidth > 768) {
        if (!openDropdown.contains(e.target)) {
            const oddsCell = e.target.closest('.odds-cell');
            if (!oddsCell || oddsCell.nextElementSibling !== openDropdown) {
                closeBetDropdown(openDropdown);
            }
        }
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && openDropdown) {
        closeBetDropdown(openDropdown);
    }
});

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.bet-dropdown').forEach(dropdown => {
        dropdown.classList.remove('show');
        dropdown.style.display = 'none';
        dropdown.style.visibility = 'hidden';
        dropdown.style.opacity = '0';
    });
});
</script>

<style>
/* Smooth scrolling for the entire page */
html {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    overflow-y: auto;
}

body {
    overflow-x: hidden;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    position: relative;
    width: 100%;
    min-height: 100vh;
}

/* Main content wrapper for smooth scrolling */
.match-detail-header {
    margin-bottom: 24px;
    width: 100%;
}

.match-detail-card {
    background: #ffffff;
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    border: 1px solid #e2e8f0;
    position: relative;
    overflow: hidden;
}

.match-detail-card.match-live::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #ef4444 0%, #f59e0b 100%);
}

.match-detail-card.match-completed::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #10b981 0%, #059669 100%);
}

.match-detail-card.match-upcoming::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #4299e1 0%, #3182ce 100%);
}

.match-teams-section-detail {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 32px;
    margin-bottom: 24px;
    flex-wrap: wrap;
}

.team-section-detail {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    flex: 1;
    min-width: 150px;
    max-width: 250px;
}

.team-logo-detail {
    width: 80px;
    height: 80px;
    object-fit: contain;
    border-radius: 50%;
    background: #f7fafc;
    padding: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.team-logo-placeholder-detail {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 32px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.team-a-placeholder {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.team-b-placeholder {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.team-name-detail {
    font-size: 20px;
    font-weight: 700;
    color: #1a202c;
    text-align: center;
    line-height: 1.4;
    word-break: break-word;
}

.vs-divider-detail {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 20px;
    flex-shrink: 0;
}

.vs-divider-detail span {
    font-size: 16px;
    font-weight: 700;
    color: #718096;
    letter-spacing: 2px;
    padding: 12px 24px;
    background: #f7fafc;
    border-radius: 30px;
    border: 2px solid #e2e8f0;
}

.match-title-section {
    text-align: center;
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #e2e8f0;
}

.match-title-text {
    font-size: 16px;
    color: #4a5568;
    font-weight: 500;
    margin: 0;
}

.match-info-section-detail {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 32px;
    flex-wrap: wrap;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.info-icon {
    font-size: 18px;
}

.info-label {
    font-size: 14px;
    color: #718096;
    font-weight: 500;
}

.info-value {
    font-size: 14px;
    color: #2d3748;
    font-weight: 600;
}

.status-badge-detail {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge-detail.status-live {
    background: #fee2e2;
    color: #dc2626;
    box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
}

.status-badge-detail.status-completed {
    background: #d1fae5;
    color: #059669;
    box-shadow: 0 2px 4px rgba(5, 150, 105, 0.2);
}

.status-badge-detail.status-upcoming {
    background: #dbeafe;
    color: #2563eb;
    box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
}

/* Back Button Styles */
.back-button:hover {
    background: #edf2f7 !important;
    border-color: #cbd5e0 !important;
    transform: translateX(-2px);
}

/* Betting Accordions Styles */
.betting-accordions-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 24px;
}

.betting-accordion-item {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    border: 1px solid #e2e8f0;
    overflow: hidden;
}

.betting-accordion-header {
    padding: 20px 24px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s;
    background: #f7fafc;
    border-bottom: 1px solid #e2e8f0;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

.betting-accordion-header:hover {
    background: #edf2f7;
}

.betting-accordion-header.active {
    background: #4299e1;
    color: white;
}

.betting-accordion-title {
    font-size: 18px;
    font-weight: 700;
    color: #2d3748;
}

.betting-accordion-header.active .betting-accordion-title {
    color: white;
}

.betting-accordion-arrow {
    font-size: 16px;
    color: #718096;
    transition: transform 0.3s ease;
    font-weight: 700;
}

.betting-accordion-header.active .betting-accordion-arrow {
    color: white;
    transform: rotate(90deg);
}

.betting-accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.3s ease;
    padding: 0 24px;
    display: flex;
    flex-direction: column;
}

.betting-accordion-content.show {
    max-height: 50000px; /* Very large value to allow full content expansion */
    padding: 24px;
    overflow-y: visible; /* Let page scroll handle overflow */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    scroll-behavior: smooth;
    will-change: scroll-position;
}

.virtual-batsmen-content {
    width: 100%;
    min-height: 0;
}

/* Match Not Started Message Styles */
.match-not-started-message {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 24px;
    text-align: center;
    background: #f7fafc;
    border-radius: 12px;
    border: 2px dashed #cbd5e0;
}

.message-icon {
    font-size: 64px;
    margin-bottom: 20px;
    opacity: 0.7;
}

.message-title {
    font-size: 24px;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 12px;
}

.message-text {
    font-size: 16px;
    color: #718096;
    line-height: 1.6;
    max-width: 500px;
}

/* Betting Interface Styles */
.betting-market {
    margin-bottom: 24px;
    position: relative;
}
.betting-market:last-child {
    margin-bottom: 0;
}
.market-title {
    font-size: 16px;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e2e8f0;
}
.runner-row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 8px;
    padding: 12px 0;
    border-bottom: 1px solid #e2e8f0;
    align-items: center;
}
.runner-row:last-child {
    border-bottom: none;
}
.runner-name {
    font-weight: 600;
    font-size: 16px;
    color: #2d3748;
    padding: 8px 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.stake-info {
    font-size: 14px;
    font-weight: 600;
    display: block;
    margin-top: 4px;
    line-height: 1.4;
}
.stake-info.lay-stake {
    color: #f56565;
}
.stake-info.back-stake {
    color: #48bb78;
}
.stake-info.hidden {
    display: none;
}
.balance-display {
    font-size: 14px;
    font-weight: 700;
    margin-top: 4px;
    padding: 2px 8px;
    border-radius: 4px;
    display: inline-block;
}
.balance-display.balance-positive {
    color: #48bb78;
    background: #c6f6d5;
}
.balance-display.balance-negative {
    color: #f56565;
    background: #fed7d7;
}
.balance-display.hidden {
    display: none;
}
.odds-cell-wrapper {
    position: relative;
    overflow: visible;
}
.odds-cell {
    display: flex;
    flex-direction: column;
    gap: 4px;
    justify-content: center;
    align-items: center;
    padding: 8px;
    transition: opacity 0.2s;
}
.odds-cell:hover {
    opacity: 0.8;
}
.bet-dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    min-width: 320px;
    max-width: 400px;
    margin-top: 8px;
    display: none !important;
    visibility: hidden;
    opacity: 0;
    border: 1px solid #e2e8f0;
    flex-direction: column;
}
.bet-dropdown.show {
    display: flex !important;
    visibility: visible;
    opacity: 1;
    animation: slideDown 0.2s ease-out;
}
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}
.bet-dropdown-header {
    padding: 12px 16px;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 8px 8px 0 0;
    font-weight: 600;
    font-size: 14px;
    position: relative;
    z-index: 1;
    flex-shrink: 0;
}
.bet-dropdown-header.back-header {
    background: #4299e1;
}
.bet-dropdown-header.lay-header {
    background: #ec4899;
}
.close-dropdown {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    line-height: 1;
    z-index: 10001;
    position: relative;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
}
.close-dropdown:hover {
    background: rgba(255, 255, 255, 0.3);
}
.close-dropdown:active {
    background: rgba(255, 255, 255, 0.4);
}
.bet-dropdown-body {
    padding: 16px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    will-change: scroll-position;
}
.bet-dropdown-actions {
    display: flex;
    gap: 8px;
    margin-top: 16px;
    flex-shrink: 0;
}
.bet-submit-btn, .bet-cancel-btn {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    position: relative;
    z-index: 1;
}
.odds-back {
    color: #ffffff;
    background: #48bb78;
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 700;
    min-width: 50px;
    display: inline-block;
    text-align: center;
}
.odds-lay {
    color: #ffffff;
    background: #f56565;
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 700;
    min-width: 50px;
    display: inline-block;
    text-align: center;
}
.header-row {
    grid-template-columns: 2fr 1fr 1fr !important;
    margin-bottom: 8px;
    padding: 8px 0;
    border-bottom: 2px solid #e2e8f0;
    font-weight: 600;
    color: #718096;
    font-size: 12px;
    text-transform: uppercase;
}

.session-details {
    margin-top: 24px;
    padding-top: 24px;
    border-top: 2px solid #e2e8f0;
}
.session-details .market-title {
    margin-bottom: 16px;
}
.session-detail-row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 8px;
    padding: 12px 0;
    border-bottom: 1px solid #e2e8f0;
    align-items: center;
}
.session-detail-row:last-child {
    border-bottom: none;
}
.session-detail-label {
    font-weight: 500;
    color: #4a5568;
    padding: 8px 0;
}

.bet-input-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}
.bet-input-label {
    font-weight: 600;
    color: #ec4899;
    font-size: 16px;
    text-transform: uppercase;
}
.bet-input-label.back-label {
    color: #4299e1;
}
.bet-input-label.lay-label {
    color: #ec4899;
}
.odds-input-dropdown {
    width: 80px;
    padding: 8px 12px;
    border: 2px solid #e2e8f0;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    background: #f7fafc;
    color: #2d3748;
}
.stake-input-dropdown {
    width: 120px;
    padding: 10px 12px;
    border: 2px solid #e2e8f0;
    border-radius: 6px;
    font-size: 16px;
    text-align: center;
    transition: all 0.2s;
}
.stake-input-dropdown:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}
.stake-display-dropdown {
    font-size: 16px;
    color: #718096;
    min-width: 40px;
}
.odds-control {
    display: flex;
    align-items: center;
    gap: 8px;
}
.odds-btn {
    width: 36px;
    height: 36px;
    border: 2px solid #ec4899;
    background: white;
    color: #ec4899;
    border-radius: 6px;
    font-size: 20px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}
.odds-btn:hover {
    background: #ec4899;
    color: white;
}
.odds-btn.back-btn {
    border-color: #4299e1;
    color: #4299e1;
}
.odds-btn.back-btn:hover {
    background: #4299e1;
    color: white;
}
.odds-btn.lay-btn {
    border-color: #ec4899;
    color: #ec4899;
}
.odds-btn.lay-btn:hover {
    background: #ec4899;
    color: white;
}
.stake-control {
    display: flex;
    align-items: center;
    gap: 8px;
}
.quick-stake-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 24px;
}
.quick-stake-btn {
    padding: 12px 8px;
    border: none;
    border-radius: 6px;
    background: #ec4899;
    color: white;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
}
.quick-stake-btn:hover {
    background: #db2777;
    transform: translateY(-1px);
}
.quick-stake-btn.back-stake {
    background: #4299e1;
}
.quick-stake-btn.back-stake:hover {
    background: #3182ce;
}
.quick-stake-btn.lay-stake {
    background: #ec4899;
}
.quick-stake-btn.lay-stake:hover {
    background: #db2777;
}
.bet-submit-btn {
    flex: 1;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    background: #48bb78;
    color: white;
}
.bet-submit-btn:hover {
    background: #38a169;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(72, 187, 120, 0.3);
}
.bet-cancel-btn {
    flex: 1;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    background: #f56565;
    color: white;
}
.bet-cancel-btn:hover {
    background: #e53e3e;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(245, 101, 101, 0.3);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .match-detail-card {
        padding: 24px;
    }
    
    .match-teams-section-detail {
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .team-section-detail {
        min-width: 120px;
        max-width: 180px;
    }
    
    .team-logo-detail,
    .team-logo-placeholder-detail {
        width: 64px;
        height: 64px;
    }
    
    .team-logo-placeholder-detail {
        font-size: 24px;
    }
    
    .team-name-detail {
        font-size: 16px;
    }
    
    .vs-divider-detail {
        padding: 0 16px;
    }
    
    .vs-divider-detail span {
        font-size: 14px;
        padding: 10px 20px;
    }
    
    .match-title-section {
        margin-bottom: 20px;
        padding-bottom: 20px;
    }
    
    .match-title-text {
        font-size: 14px;
    }
    
    .match-info-section-detail {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    
    .info-item {
        width: 100%;
        justify-content: flex-start;
    }
    
    .betting-accordions-container {
        gap: 12px;
    }
    
    .betting-accordion-item {
        border-radius: 10px;
    }
    
    .betting-accordion-header {
        padding: 16px 18px;
    }
    
    .betting-accordion-title {
        font-size: 16px;
    }
    
    .betting-accordion-arrow {
        font-size: 14px;
    }
    
    .betting-accordion-content {
        padding: 0 18px;
    }
    
    .betting-accordion-content.show {
        padding: 18px;
        max-height: 50000px; /* Very large value to allow full content expansion */
        overflow-y: visible; /* Let page scroll handle overflow */
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        scroll-behavior: smooth;
        will-change: scroll-position;
    }
    
    /* Match Not Started Message Mobile Styles */
    .match-not-started-message {
        padding: 40px 20px;
    }
    
    .message-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }
    
    .message-title {
        font-size: 20px;
        margin-bottom: 10px;
    }
    
    .message-text {
        font-size: 14px;
    }
    
    .back-button {
        padding: 8px 16px !important;
        font-size: 13px !important;
    }
    
    .runner-row {
        grid-template-columns: 2fr 1fr 1fr;
        gap: 8px;
        padding: 12px 0;
    }
    .runner-name {
        font-size: 15px;
    }
    .odds-back, .odds-lay {
        padding: 5px 8px;
        border-radius: 4px;
        min-width: 45px;
        font-size: 14px;
    }
    .session-detail-row {
        grid-template-columns: 2fr 1fr 1fr;
        gap: 8px;
        padding: 12px 0;
    }
    .bet-dropdown {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        width: 100%;
        max-width: 100%;
        min-width: 100%;
        margin: 0;
        border-radius: 12px 12px 0 0;
        z-index: 10000;
        max-height: 90vh;
        overflow: hidden;
        transform: none;
        animation: slideUpFromBottom 0.3s ease-out;
        display: flex;
        flex-direction: column;
    }
    .bet-dropdown.show {
        display: flex !important;
        visibility: visible;
        opacity: 1;
        animation: slideUpFromBottom 0.3s ease-out;
    }
    @keyframes slideUpFromBottom {
        from {
            transform: translateY(100%);
        }
        to {
            transform: translateY(0);
        }
    }
    .bet-dropdown-header {
        padding: 16px 20px;
        font-size: 16px;
    }
    .bet-dropdown-body {
        padding: 12px;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
        will-change: scroll-position;
        flex: 1;
        min-height: 0;
        max-height: calc(90vh - 60px);
        touch-action: pan-y;
        overscroll-behavior: contain;
    }
    .close-dropdown {
        width: 36px;
        height: 36px;
        font-size: 22px;
    }
    .quick-stake-buttons {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
    }
    .quick-stake-btn {
        padding: 10px 6px;
        font-size: 12px;
    }
    .bet-dropdown-actions {
        margin-top: 20px;
    }
    .bet-submit-btn, .bet-cancel-btn {
        padding: 14px 16px;
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .match-detail-card {
        padding: 20px;
    }
    
    .match-teams-section-detail {
        gap: 16px;
    }
    
    .team-section-detail {
        min-width: 100px;
        max-width: 140px;
    }
    
    .team-logo-detail,
    .team-logo-placeholder-detail {
        width: 56px;
        height: 56px;
    }
    
    .team-logo-placeholder-detail {
        font-size: 20px;
    }
    
    .team-name-detail {
        font-size: 14px;
    }
    
    .vs-divider-detail span {
        font-size: 12px;
        padding: 8px 16px;
    }
    
    .betting-accordions-container {
        gap: 10px;
    }
    
    .betting-accordion-item {
        border-radius: 8px;
    }
    
    .betting-accordion-header {
        padding: 14px 16px;
    }
    
    .betting-accordion-title {
        font-size: 15px;
    }
    
    .betting-accordion-arrow {
        font-size: 13px;
    }
    
    .betting-accordion-content {
        padding: 0 16px;
        position: relative;
    }
    
    .betting-accordion-content.show {
        padding: 16px;
        max-height: 50000px; /* Very large value to allow full content expansion */
        overflow-y: visible; /* Let page scroll handle overflow */
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        scroll-behavior: smooth;
        will-change: scroll-position;
    }
    
    /* Allow full page scrolling - don't restrict accordion height */
    body {
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch !important;
        scroll-behavior: smooth !important;
        position: relative !important;
    }
    
    html {
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch !important;
        scroll-behavior: smooth !important;
        height: 100%;
    }
    
    /* Main container should allow full scrolling */
    .container, [class*="container"] {
        overflow: visible !important;
    }
    
    /* Ensure betting accordions container doesn't restrict scrolling */
    .betting-accordions-container {
        overflow: visible !important;
        min-height: auto;
    }
    
    .back-button {
        padding: 8px 14px !important;
        font-size: 12px !important;
    }
    
    /* Fix form elements in mobile accordion */
    .virtual-batsmen-content {
        width: 100%;
    }
    
    /* Match Not Started Message Mobile Styles */
    .match-not-started-message {
        padding: 40px 20px;
    }
    
    .message-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }
    
    .message-title {
        font-size: 20px;
        margin-bottom: 10px;
    }
    
    .message-text {
        font-size: 14px;
    }
    
    #choose-virtual .form-group {
        margin-bottom: 16px;
    }
    
    #choose-virtual .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2d3748;
        font-size: 14px;
    }
    
    #choose-virtual .form-control {
        width: 100%;
        padding: 12px;
        font-size: 16px; /* Prevents zoom on iOS */
        border-radius: 8px;
        border: 2px solid #e2e8f0;
        box-sizing: border-box;
    }
    
    #choose-virtual .form-control:focus {
        outline: none;
        border-color: #4299e1;
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
    }
    
    #choose-virtual .btn {
        width: 100%;
        padding: 14px;
        font-size: 16px;
        margin-top: 8px;
    }
    
    #choose-virtual .card-header h3 {
        font-size: 18px;
    }
    
    #choose-virtual p {
        font-size: 14px;
        line-height: 1.5;
    }
    
    .runner-row, .session-detail-row {
        padding: 10px 0;
    }
    .runner-name, .session-detail-label {
        font-size: 14px;
    }
    .odds-back, .odds-lay {
        padding: 5px 8px;
        font-size: 13px;
        min-width: 45px;
    }
}
</style>
{% endblock %}
