{% extends 'core/base.html' %}

{% block title %}Home - CricketDuel{% endblock %}

{% block content %}
<div class="user-info" style="justify-content: flex-end; margin-bottom: 20px;">
    {% if user.is_authenticated %}
        <div class="wallet-balance">
            Wallet: â‚¹{{ user.wallet.balance|default:"0.00" }}
        </div>
    {% endif %}
</div>

<h2 style="margin-bottom: 20px;">Live Matches</h2>
{% if live_matches %}
    <div class="grid">
        {% for match in live_matches %}
            <div class="card">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    {% if match.team_a.logo %}
                        <img src="{{ match.team_a.logo.url }}" alt="{{ match.team_a.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% elif match.team_a.logo_url %}
                        <img src="{{ match.team_a.logo_url }}" alt="{{ match.team_a.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% else %}
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                    display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">
                            {{ match.team_a.name|first|upper }}
                        </div>
                    {% endif %}
                    <span style="font-weight: bold; font-size: 18px;">vs</span>
                    {% if match.team_b.logo %}
                        <img src="{{ match.team_b.logo.url }}" alt="{{ match.team_b.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% elif match.team_b.logo_url %}
                        <img src="{{ match.team_b.logo_url }}" alt="{{ match.team_b.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% else %}
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                    display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">
                            {{ match.team_b.name|first|upper }}
                        </div>
                    {% endif %}
                    <div style="flex: 1;">
                        <h3 style="margin: 0;">{{ match.team_a.name }} vs {{ match.team_b.name }}</h3>
                    </div>
                </div>
                <p><strong>{{ match.match_title }}</strong></p>
                <p>{{ match.venue }}</p>
                <p>Status: <span style="color: #4caf50; font-weight: bold;">{{ match.get_status_display }}</span></p>
                <a href="{% url 'core:match_detail' match.id %}" class="btn">View Details</a>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>No live matches at the moment.</p>
{% endif %}

<h2 style="margin-top: 40px; margin-bottom: 20px;">Upcoming Matches</h2>
{% if upcoming_matches %}
    <div class="grid">
        {% for match in upcoming_matches %}
            <div class="card">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    {% if match.team_a.logo %}
                        <img src="{{ match.team_a.logo.url }}" alt="{{ match.team_a.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% elif match.team_a.logo_url %}
                        <img src="{{ match.team_a.logo_url }}" alt="{{ match.team_a.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% else %}
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                    display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">
                            {{ match.team_a.name|first|upper }}
                        </div>
                    {% endif %}
                    <span style="font-weight: bold; font-size: 18px;">vs</span>
                    {% if match.team_b.logo %}
                        <img src="{{ match.team_b.logo.url }}" alt="{{ match.team_b.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% elif match.team_b.logo_url %}
                        <img src="{{ match.team_b.logo_url }}" alt="{{ match.team_b.name }}" 
                             style="width: 50px; height: 50px; object-fit: contain;">
                    {% else %}
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                    display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">
                            {{ match.team_b.name|first|upper }}
                        </div>
                    {% endif %}
                    <div style="flex: 1;">
                        <h3 style="margin: 0;">{{ match.team_a.name }} vs {{ match.team_b.name }}</h3>
                    </div>
                </div>
                <p><strong>{{ match.match_title }}</strong></p>
                <p>{{ match.venue }}</p>
                <p>Date: {{ match.match_date|date:"M d, Y H:i" }}</p>
                <a href="{% url 'core:match_detail' match.id %}" class="btn">View Details</a>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>No upcoming matches.</p>
{% endif %}

{% if active_sessions %}
    <h2 style="margin-top: 40px; margin-bottom: 20px;">My Active Sessions</h2>
    <div class="grid">
        {% for session in active_sessions %}
            <div class="card">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                    {% if session.better_a == user %}
                        {% with opponent=session.better_b %}
                            {% if opponent.profile.profile_picture %}
                                <img src="{{ opponent.profile.profile_picture.url }}" alt="{{ opponent.username }}" 
                                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                            {% else %}
                                <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                            display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                    {{ opponent.username|first|upper }}
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% else %}
                        {% with opponent=session.better_a %}
                            {% if opponent.profile.profile_picture %}
                                <img src="{{ opponent.profile.profile_picture.url }}" alt="{{ opponent.username }}" 
                                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                            {% else %}
                                <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                            display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                    {{ opponent.username|first|upper }}
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                    <div style="flex: 1;">
                        <h3 style="margin: 0;">Session #{{ session.id }}</h3>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                            {% if session.match.team_a.logo %}
                                <img src="{{ session.match.team_a.logo.url }}" alt="{{ session.match.team_a.name }}" 
                                     style="width: 30px; height: 30px; object-fit: contain;">
                            {% elif session.match.team_a.logo_url %}
                                <img src="{{ session.match.team_a.logo_url }}" alt="{{ session.match.team_a.name }}" 
                                     style="width: 30px; height: 30px; object-fit: contain;">
                            {% else %}
                                <div style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                            display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">
                                    {{ session.match.team_a.name|first|upper }}
                                </div>
                            {% endif %}
                            <span style="font-weight: bold;">vs</span>
                            {% if session.match.team_b.logo %}
                                <img src="{{ session.match.team_b.logo.url }}" alt="{{ session.match.team_b.name }}" 
                                     style="width: 30px; height: 30px; object-fit: contain;">
                            {% elif session.match.team_b.logo_url %}
                                <img src="{{ session.match.team_b.logo_url }}" alt="{{ session.match.team_b.name }}" 
                                     style="width: 30px; height: 30px; object-fit: contain;">
                            {% else %}
                                <div style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                            display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">
                                    {{ session.match.team_b.name|first|upper }}
                                </div>
                            {% endif %}
                            <strong style="margin-left: 5px;">{{ session.match.team_a.name }} vs {{ session.match.team_b.name }}</strong>
                        </div>
                    </div>
                </div>
                <p>Status: {{ session.get_status_display }}</p>
                <p>vs: {% if session.better_a == user %}{{ session.better_b.username }}{% else %}{{ session.better_a.username }}{% endif %}</p>
                <a href="{% url 'core:session_detail' session.id %}" class="btn">View Session</a>
            </div>
        {% endfor %}
    </div>
{% endif %}
{% endblock %}
